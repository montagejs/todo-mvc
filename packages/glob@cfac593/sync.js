function globSync(t,r){if("function"==typeof r||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");return new GlobSync(t,r).found}function GlobSync(t,r){if(!t)throw new Error("must provide pattern");if("function"==typeof r||3===arguments.length)throw new TypeError("callback provided to sync glob\nSee: https://github.com/isaacs/node-glob/issues/167");if(!(this instanceof GlobSync))return new GlobSync(t,r);if(setopts(this,t,r),this.noprocess)return this;var i=this.minimatch.set.length;this.matches=new Array(i);for(var s=0;s<i;s++)this._process(this.minimatch.set[s],s,!1);this._finish()}module.exports=globSync,globSync.GlobSync=GlobSync;var fs=require("fs"),rp=require("fs.realpath"),minimatch=require("minimatch"),Minimatch=minimatch.Minimatch,Glob=require("./glob.js").Glob,util=require("util"),path=require("path"),assert=require("assert"),isAbsolute=require("path-is-absolute"),common=require("./common.js"),alphasort=common.alphasort,alphasorti=common.alphasorti,setopts=common.setopts,ownProp=common.ownProp,childrenIgnored=common.childrenIgnored,isIgnored=common.isIgnored;GlobSync.prototype._finish=function(){if(assert(this instanceof GlobSync),this.realpath){var t=this;this.matches.forEach(function(r,i){var s=t.matches[i]=Object.create(null);for(var e in r)try{e=t._makeAbs(e);var o=rp.realpathSync(e,t.realpathCache);s[o]=!0}catch(a){if("stat"!==a.syscall)throw a;s[t._makeAbs(e)]=!0}})}common.finish(this)},GlobSync.prototype._process=function(t,r,i){assert(this instanceof GlobSync);for(var s=0;"string"==typeof t[s];)s++;var e;switch(s){case t.length:return void this._processSimple(t.join("/"),r);case 0:e=null;break;default:e=t.slice(0,s).join("/")}var o,a=t.slice(s);null===e?o=".":isAbsolute(e)||isAbsolute(t.join("/"))?(e&&isAbsolute(e)||(e="/"+e),o=e):o=e;var c=this._makeAbs(o);if(!childrenIgnored(this,o)){var n=a[0]===minimatch.GLOBSTAR;n?this._processGlobStar(e,o,c,a,r,i):this._processReaddir(e,o,c,a,r,i)}},GlobSync.prototype._processReaddir=function(t,r,i,s,e,o){var a=this._readdir(i,o);if(a){for(var c=s[0],n=!!this.minimatch.negate,h=c._glob,l=this.dot||"."===h.charAt(0),f=[],m=0;m<a.length;m++){var p=a[m];if("."!==p.charAt(0)||l){var u;u=n&&!t?!p.match(c):p.match(c),u&&f.push(p)}}var y=f.length;if(0!==y)if(1!==s.length||this.mark||this.stat){s.shift();for(var m=0;m<y;m++){var b,p=f[m];b=t?[t,p]:[p],this._process(b.concat(s),e,o)}}else{this.matches[e]||(this.matches[e]=Object.create(null));for(var m=0;m<y;m++){var p=f[m];t&&(p="/"!==t.slice(-1)?t+"/"+p:t+p),"/"!==p.charAt(0)||this.nomount||(p=path.join(this.root,p)),this._emitMatch(e,p)}}}},GlobSync.prototype._emitMatch=function(t,r){if(!isIgnored(this,r)){var i=this._makeAbs(r);if(this.mark&&(r=this._mark(r)),this.absolute&&(r=i),!this.matches[t][r]){if(this.nodir){var s=this.cache[i];if("DIR"===s||Array.isArray(s))return}this.matches[t][r]=!0,this.stat&&this._stat(r)}}},GlobSync.prototype._readdirInGlobStar=function(t){if(this.follow)return this._readdir(t,!1);var r,i;try{i=fs.lstatSync(t)}catch(s){if("ENOENT"===s.code)return null}var e=i&&i.isSymbolicLink();return this.symlinks[t]=e,e||!i||i.isDirectory()?r=this._readdir(t,!1):this.cache[t]="FILE",r},GlobSync.prototype._readdir=function(t,r){if(r&&!ownProp(this.symlinks,t))return this._readdirInGlobStar(t);if(ownProp(this.cache,t)){var i=this.cache[t];if(!i||"FILE"===i)return null;if(Array.isArray(i))return i}try{return this._readdirEntries(t,fs.readdirSync(t))}catch(s){return this._readdirError(t,s),null}},GlobSync.prototype._readdirEntries=function(t,r){if(!this.mark&&!this.stat)for(var i=0;i<r.length;i++){var s=r[i];s="/"===t?t+s:t+"/"+s,this.cache[s]=!0}return this.cache[t]=r,r},GlobSync.prototype._readdirError=function(t,r){switch(r.code){case"ENOTSUP":case"ENOTDIR":var i=this._makeAbs(t);if(this.cache[i]="FILE",i===this.cwdAbs){var s=new Error(r.code+" invalid cwd "+this.cwd);throw s.path=this.cwd,s.code=r.code,s}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(t)]=!1;break;default:if(this.cache[this._makeAbs(t)]=!1,this.strict)throw r;this.silent||console.error("glob error",r)}},GlobSync.prototype._processGlobStar=function(t,r,i,s,e,o){var a=this._readdir(i,o);if(a){var c=s.slice(1),n=t?[t]:[],h=n.concat(c);this._process(h,e,!1);var l=a.length,f=this.symlinks[i];if(!f||!o)for(var m=0;m<l;m++){var p=a[m];if("."!==p.charAt(0)||this.dot){var u=n.concat(a[m],c);this._process(u,e,!0);var y=n.concat(a[m],s);this._process(y,e,!0)}}}},GlobSync.prototype._processSimple=function(t,r){var i=this._stat(t);if(this.matches[r]||(this.matches[r]=Object.create(null)),i){if(t&&isAbsolute(t)&&!this.nomount){var s=/[\/\\]$/.test(t);"/"===t.charAt(0)?t=path.join(this.root,t):(t=path.resolve(this.root,t),s&&(t+="/"))}"win32"===process.platform&&(t=t.replace(/\\/g,"/")),this._emitMatch(r,t)}},GlobSync.prototype._stat=function(t){var r=this._makeAbs(t),i="/"===t.slice(-1);if(t.length>this.maxLength)return!1;if(!this.stat&&ownProp(this.cache,r)){var s=this.cache[r];if(Array.isArray(s)&&(s="DIR"),!i||"DIR"===s)return s;if(i&&"FILE"===s)return!1}var e=this.statCache[r];if(!e){var o;try{o=fs.lstatSync(r)}catch(a){if(a&&("ENOENT"===a.code||"ENOTDIR"===a.code))return this.statCache[r]=!1,!1}if(o&&o.isSymbolicLink())try{e=fs.statSync(r)}catch(a){e=o}else e=o}this.statCache[r]=e;var s=!0;return e&&(s=e.isDirectory()?"DIR":"FILE"),this.cache[r]=this.cache[r]||s,(!i||"FILE"!==s)&&s},GlobSync.prototype._mark=function(t){return common.mark(this,t)},GlobSync.prototype._makeAbs=function(t){return common.makeAbs(this,t)};