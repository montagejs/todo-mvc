montageDefine("667c839","test/exit_test",{dependencies:["fs","child_process","which"],factory:function(t,e,n){"use strict";function o(t){try{return d(t),t}catch(e){return!1}}function r(t){return t.replace(/\r?\n/g,"\n")}function c(t,e){f(t,function(t,n){e(t?t.code:0,r(n))})}function i(t){return r(String(u.readFileSync(t)))}function s(){var t=[10,100,1e3],n=[" stdout stderr"," stdout"," stderr"],o=[""," | "+a+' "std"'];t.forEach(function(t){n.forEach(function(n){o.forEach(function(o){var r="node log.js 0 "+t+n+" 2>&1"+o;e.exit["output ("+r+")"]=function(e){e.expect(2),c(r,function(o,r){var c=i(t+n.replace(/ /g,"-")+".txt");e.equal(r.length,c.length,"should be the same length."),e.ok(r.indexOf("fail")===-1,"should not output after exit is called."),e.done()})}})})});var r=[0,1,123];r.forEach(function(t){var n="node log.js "+t+" 10 stdout stderr";e.exit["exit code ("+n+")"]=function(e){e.expect(1),c(n,function(n){e.equal(n,t,"should exit with "+t+" error code."),e.done()})}})}var u=t("fs"),f=t("child_process").exec,d=t("which").sync,a=o("grep")||"win32"===process.platform&&o("find");e.exit={setUp:function(t){this.origCwd=process.cwd(),process.chdir("test/fixtures"),t()},tearDown:function(t){process.chdir(this.origCwd),t()},grep:function(t){t.expect(1),t.ok(a,'A suitable "grep" or "find" program was not found in the PATH.'),t.done()}},a&&s()}});