montageDefine("46b7068","montage",{dependencies:["./node.js"],factory:function(e,t,n){!function(o,r){"function"==typeof define&&define.amd?define("montage",[],r):"object"==typeof n&&n.exports?n.exports=r(e,t,n):o.Montage=r({},{},{})}(this,function(e,t,n){"use strict";var o=eval,r=o("this");r.global=r,t.initMontage=function(){var e=t.getPlatform();e.bootstrap(function(n,o,i){var c=e.getParams(),s={location:n.getLocation()};t.Require=n;var d=i.resolve(s.location,c.montageLocation),l=i.resolve(s.location,c["package"]||"."),u=c.applicationHash;if("object"==typeof r.BUNDLE){var m={},f=function(e){if(!m[e]){var t=m[e]={},n=new o(function(e,n){t.resolve=e,t.reject=n});return t.promise=n,t}return m[e]};r.bundleLoaded=function(e){f(e).resolve()};var p={},g=new o(function(e,t){p.resolve=e,p.reject=t});p.promise=g,s.preloaded=p.promise;var v=o.resolve();r.BUNDLE.forEach(function(e){v=v.then(function(){return o.all(e.map(function(e){return a.load(e),f(e).promise}))})}),p.resolve(v.then(function(){delete r.BUNDLE,delete r.bundleLoaded}))}var h;if("remoteTrigger"in c){window.postMessage({type:"montageReady"},"*");var b=new o(function(e){var t=function(n){if(c.remoteTrigger===n.origin&&(n.source===window||n.source===window.parent))switch(n.data.type){case"montageInit":window.removeEventListener("message",t),e([n.data.location,n.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",t)});h=b.spread(function(e,t){var o=n.loadPackage({location:e,hash:u},s);return t&&(o=o.then(function(n){e=i.resolve(e,".");var o,r,a=t.packageDescriptions,c=t.packageDescriptionLocations,s=t.mappings,d=t.dependencies;if(a)for(r=a.length,o=0;o<r;o++)n.injectPackageDescription(a[o].location,a[o].description);if(c)for(r=c.length,o=0;o<r;o++)n.injectPackageDescriptionLocation(c[o].location,c[o].descriptionLocation);if(s)for(r=s.length,o=0;o<r;o++)n.injectMapping(s[o].dependency,s[o].name);if(d)for(r=d.length,o=0;o<r;o++)n.injectDependency(d[o].name,d[o].version);return n})),o})}else{if("autoPackage"in c)n.injectPackageDescription(l,{dependencies:{montage:"*"}},s);else if(".json"===l.slice(l.length-5)){var w=l;l=i.resolve(l,"."),n.injectPackageDescriptionLocation(l,w,s)}h=n.loadPackage({location:l,hash:u},s)}h.then(function(t){return t.loadPackage({location:d,hash:c.montageHash}).then(function(e){var t;t=c.promiseLocation?i.resolve(n.getLocation(),c.promiseLocation):i.resolve(d,"node_modules/bluebird");var o=[e,e.loadPackage({location:t,hash:c.promiseHash})];return o}).spread(function(n,a){return n.inject("core/mini-url",i),n.inject("core/promise",{Promise:o}),a.inject("bluebird",o),a.inject("js/browser/bluebird",o),s.lint=function(e){n.async("jslint/lib/jslint").then(function(t){t.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),t.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))})},r.require=r.mr=t,e.initMontage(n,t,c)})})})},t.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return a;if("undefined"!=typeof process)return e("./node.js");throw new Error("Platform not supported.")};var a={makeResolve:function(){try{var e="http://example.org",t="/test.html",n=new URL(t,e).href;if(!n||n!==e+t)throw new Error("NotSupported");return function(e,t){return new URL(t,e).href}}catch(o){var r=/^[\w\-]+:/,a=document.querySelector("head"),i=a.querySelector("base"),c=document.createElement("base"),s=document.createElement("a"),d=!1;return i?d=!0:i=document.createElement("base"),c.href="",function(e,t){var n;if(d||a.appendChild(i),e=String(e),r.test(e)===!1)throw new Error("Can't resolve from a relative location: "+JSON.stringify(e)+" "+JSON.stringify(t));d&&(n=i.href),i.href=e,s.href=t;var o=s.href;return d?i.href=n:a.removeChild(i),o}}},load:function(e,t){var n=document.createElement("script");n.src=e,n.onload=function(){t&&t(n),n.parentNode.removeChild(n)},document.getElementsByTagName("head")[0].appendChild(n)},getParams:function(){var e,t,n,o,r,a,i;if(!this._params){this._params={};var c=document.getElementsByTagName("script");for(e=0;e<c.length;e++)if(o=c[e],r=!1,o.src&&(n=o.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=n[1],r=!0),o.hasAttribute("data-montage-location")&&(this._params.montageLocation=o.getAttribute("data-montage-location"),r=!0),r){if(o.dataset)for(i in o.dataset)this._params[i]=o.dataset[i];else if(o.attributes){var s=/^data-(.*)$/,d=/-([a-z])/g,l=function(e,t){return t.toUpperCase()};for(t=0;t<o.attributes.length;t++)a=o.attributes[t],n=a.name.match(s),n&&(this._params[n[1].replace(d,l)]=a.value)}o.parentNode.removeChild(o);break}}return this._params},bootstrap:function(e){function t(){document.removeEventListener("DOMContentLoaded",t,!0),s=!0;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming=document._montageTiming||{},document._montageTiming.bootstrappingStartTime=Date.now(),i()}function n(e){if(!v[e]&&p[e]){var t=v[e]={};v[e]=p[e](n,t)||t}return v[e]}function o(){l=n("mini-url"),d=n("promise"),c=n("require"),delete r.bootstrap,i()}function i(){s&&c&&e(c,d,l)}var c,s,d,l,u=this.getParams(),m=this.makeResolve();/interactive|complete/.test(document.readyState)?t():document.addEventListener("DOMContentLoaded",t,!0);var f={require:"node_modules/mr/require.js","require/browser":"node_modules/mr/browser.js",promise:"node_modules/bluebird/js/browser/bluebird.min.js"},p={};if(r.bootstrap=function(e,t){p[e]=t,delete f[e];for(var n in f)return;o()},"undefined"==typeof r.BUNDLE){var g=m(r.location,u.montageLocation);a.load(m(g,f.promise),function(){delete f.promise,r.bootstrap("bluebird",function(e,t){return r.Promise}),r.bootstrap("promise",function(e,t){return r.Promise});for(var e in f)a.load(m(g,f[e]))})}else r.nativePromise=r.Promise,Object.defineProperty(r,"Promise",{configurable:!0,set:function(e){Object.defineProperty(r,"Promise",{value:e}),r.bootstrap("bluebird",function(e,t){return r.Promise}),r.bootstrap("promise",function(e,t){return r.Promise})}});r.bootstrap("mini-url",function(e,t){t.resolve=m});var v={}},initMontage:function(e,t,n){for(var o,a=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger"],i=e("core/promise").Promise,c=[],s=0;o=a[s];s++)c.push(e.deepLoad(o));return i.all(c).then(function(){for(var o,i=0;o=a[i];i++)e(o);var c,s,d=(e("core/core").Montage,e("core/event/event-manager").EventManager),l=e("core/serialization/deserializer/montage-reviver").MontageReviver;e("core/logger").logger;c=(new d).initWithWindow(window),"function"==typeof r.montageWillLoad&&r.montageWillLoad();var u,m,f=t.packageDescription.applicationPrototype;return f?(u=l.parseObjectLocationId(f),m=t.async(u.moduleId)):m=e.async("core/application"),m.then(function(e){var o=e[u?u.objectName:"Application"];return s=new o,c.application=s,s.eventManager=c,s._load(t,function(){n.module&&t.async(n.module),"function"==typeof r.montageDidLoad&&r.montageDidLoad()})})})}};return"undefined"!=typeof window?r.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(r.__MONTAGE_LOADED__=!0,t.initMontage()):t.getPlatform(),t})}});