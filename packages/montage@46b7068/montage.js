!function(e,t){"function"==typeof define&&define.amd?define("montage",[],t):"object"==typeof module&&module.exports?module.exports=t(require,exports,module):e.Montage=t({},{},{})}(this,function(e,t,o){"use strict";var n=eval,r=n("this");r.global=r,t.initMontage=function(){var e=t.getPlatform();e.bootstrap(function(o,n,i){var c=e.getParams(),s={location:o.getLocation()};t.Require=o;var d=i.resolve(s.location,c.montageLocation),l=i.resolve(s.location,c["package"]||"."),u=c.applicationHash;if("object"==typeof r.BUNDLE){var m={},p=function(e){if(!m[e]){var t=m[e]={},o=new n(function(e,o){t.resolve=e,t.reject=o});return t.promise=o,t}return m[e]};r.bundleLoaded=function(e){p(e).resolve()};var f={},g=new n(function(e,t){f.resolve=e,f.reject=t});f.promise=g,s.preloaded=f.promise;var v=n.resolve();r.BUNDLE.forEach(function(e){v=v.then(function(){return n.all(e.map(function(e){return a.load(e),p(e).promise}))})}),f.resolve(v.then(function(){delete r.BUNDLE,delete r.bundleLoaded}))}var h;if("remoteTrigger"in c){window.postMessage({type:"montageReady"},"*");var b=new n(function(e){var t=function(o){if(c.remoteTrigger===o.origin&&(o.source===window||o.source===window.parent))switch(o.data.type){case"montageInit":window.removeEventListener("message",t),e([o.data.location,o.data.injections]);break;case"isMontageReady":window.postMessage({type:"montageReady"},"*")}};window.addEventListener("message",t)});h=b.spread(function(e,t){var n=o.loadPackage({location:e,hash:u},s);return t&&(n=n.then(function(o){e=i.resolve(e,".");var n,r,a=t.packageDescriptions,c=t.packageDescriptionLocations,s=t.mappings,d=t.dependencies;if(a)for(r=a.length,n=0;n<r;n++)o.injectPackageDescription(a[n].location,a[n].description);if(c)for(r=c.length,n=0;n<r;n++)o.injectPackageDescriptionLocation(c[n].location,c[n].descriptionLocation);if(s)for(r=s.length,n=0;n<r;n++)o.injectMapping(s[n].dependency,s[n].name);if(d)for(r=d.length,n=0;n<r;n++)o.injectDependency(d[n].name,d[n].version);return o})),n})}else{if("autoPackage"in c)o.injectPackageDescription(l,{dependencies:{montage:"*"}},s);else if(".json"===l.slice(l.length-5)){var w=l;l=i.resolve(l,"."),o.injectPackageDescriptionLocation(l,w,s)}h=o.loadPackage({location:l,hash:u},s)}h.then(function(t){return t.loadPackage({location:d,hash:c.montageHash}).then(function(e){var t;t=c.promiseLocation?i.resolve(o.getLocation(),c.promiseLocation):i.resolve(d,"node_modules/bluebird");var n=[e,e.loadPackage({location:t,hash:c.promiseHash})];return n}).spread(function(o,a){return o.inject("core/mini-url",i),o.inject("core/promise",{Promise:n}),a.inject("bluebird",n),a.inject("js/browser/bluebird",n),s.lint=function(e){o.async("jslint/lib/jslint").then(function(t){t.JSHINT(e.text)||(console.warn("JSHint Error: "+e.location),t.JSHINT.errors.forEach(function(e){e&&(console.warn("Problem at line "+e.line+" character "+e.character+": "+e.reason),e.evidence&&console.warn("    "+e.evidence))}))})},r.require=r.mr=t,e.initMontage(o,t,c)})})})},t.getPlatform=function(){if("undefined"!=typeof window&&window&&window.document)return a;if("undefined"!=typeof process)return e("./node.js");throw new Error("Platform not supported.")};var a={makeResolve:function(){try{var e="http://example.org",t="/test.html",o=new URL(t,e).href;if(!o||o!==e+t)throw new Error("NotSupported");return function(e,t){return new URL(t,e).href}}catch(n){var r=/^[\w\-]+:/,a=document.querySelector("head"),i=a.querySelector("base"),c=document.createElement("base"),s=document.createElement("a"),d=!1;return i?d=!0:i=document.createElement("base"),c.href="",function(e,t){var o;if(d||a.appendChild(i),e=String(e),r.test(e)===!1)throw new Error("Can't resolve from a relative location: "+JSON.stringify(e)+" "+JSON.stringify(t));d&&(o=i.href),i.href=e,s.href=t;var n=s.href;return d?i.href=o:a.removeChild(i),n}}},load:function(e,t){var o=document.createElement("script");o.src=e,o.onload=function(){t&&t(o),o.parentNode.removeChild(o)},document.getElementsByTagName("head")[0].appendChild(o)},getParams:function(){var e,t,o,n,r,a,i;if(!this._params){this._params={};var c=document.getElementsByTagName("script");for(e=0;e<c.length;e++)if(n=c[e],r=!1,n.src&&(o=n.src.match(/^(.*)montage.js(?:[\?\.]|$)/i))&&(this._params.montageLocation=o[1],r=!0),n.hasAttribute("data-montage-location")&&(this._params.montageLocation=n.getAttribute("data-montage-location"),r=!0),r){if(n.dataset)for(i in n.dataset)this._params[i]=n.dataset[i];else if(n.attributes){var s=/^data-(.*)$/,d=/-([a-z])/g,l=function(e,t){return t.toUpperCase()};for(t=0;t<n.attributes.length;t++)a=n.attributes[t],o=a.name.match(s),o&&(this._params[o[1].replace(d,l)]=a.value)}n.parentNode.removeChild(n);break}}return this._params},bootstrap:function(e){function t(){document.removeEventListener("DOMContentLoaded",t,!0),s=!0;var e=document.documentElement;e.classList?e.classList.add("montage-app-bootstrapping"):e.className=e.className+" montage-app-bootstrapping",document._montageTiming=document._montageTiming||{},document._montageTiming.bootstrappingStartTime=Date.now(),i()}function o(e){if(!v[e]&&f[e]){var t=v[e]={};v[e]=f[e](o,t)||t}return v[e]}function n(){l=o("mini-url"),d=o("promise"),c=o("require"),delete r.bootstrap,i()}function i(){s&&c&&e(c,d,l)}var c,s,d,l,u=this.getParams(),m=this.makeResolve();/interactive|complete/.test(document.readyState)?t():document.addEventListener("DOMContentLoaded",t,!0);var p={require:"node_modules/mr/require.js","require/browser":"node_modules/mr/browser.js",promise:"node_modules/bluebird/js/browser/bluebird.min.js"},f={};if(r.bootstrap=function(e,t){f[e]=t,delete p[e];for(var o in p)return;n()},"undefined"==typeof r.BUNDLE){var g=m(r.location,u.montageLocation);a.load(m(g,p.promise),function(){delete p.promise,r.bootstrap("bluebird",function(e,t){return r.Promise}),r.bootstrap("promise",function(e,t){return r.Promise});for(var e in p)a.load(m(g,p[e]))})}else r.nativePromise=r.Promise,Object.defineProperty(r,"Promise",{configurable:!0,set:function(e){Object.defineProperty(r,"Promise",{value:e}),r.bootstrap("bluebird",function(e,t){return r.Promise}),r.bootstrap("promise",function(e,t){return r.Promise})}});r.bootstrap("mini-url",function(e,t){t.resolve=m});var v={}},initMontage:function(e,t,o){for(var n,a=["core/core","core/event/event-manager","core/serialization/deserializer/montage-reviver","core/logger"],i=e("core/promise").Promise,c=[],s=0;n=a[s];s++)c.push(e.deepLoad(n));return i.all(c).then(function(){for(var n,i=0;n=a[i];i++)e(n);var c,s,d=(e("core/core").Montage,e("core/event/event-manager").EventManager),l=e("core/serialization/deserializer/montage-reviver").MontageReviver;e("core/logger").logger;c=(new d).initWithWindow(window),"function"==typeof r.montageWillLoad&&r.montageWillLoad();var u,m,p=t.packageDescription.applicationPrototype;return p?(u=l.parseObjectLocationId(p),m=t.async(u.moduleId)):m=e.async("core/application"),m.then(function(e){var n=e[u?u.objectName:"Application"];return s=new n,c.application=s,s.eventManager=c,s._load(t,function(){o.module&&t.async(o.module),"function"==typeof r.montageDidLoad&&r.montageDidLoad()})})})}};return"undefined"!=typeof window?r.__MONTAGE_LOADED__?console.warn("Montage already loaded!"):(r.__MONTAGE_LOADED__=!0,t.initMontage()):t.getPlatform(),t});