function _name(){var e="";return this===Function||this===Function.prototype.constructor?e="Function":this!==Function.prototype&&(e=(""+this).replace(fnNamePrefixRegex,"").replace(fnNameSuffixRegex,"")),e}function getAttributeProperties(e,t,r){var n=r||(t===SERIALIZABLE?_serializableAttributeProperties:UNDERSCORE+t+ATTRIBUTE_PROPERTIES);return e!==Object.prototype?e.hasOwnProperty(n)?e[n]:Object.defineProperty(e,n,{enumerable:!1,configurable:!1,writable:!0,value:Object.create(getAttributeProperties(Object.getPrototypeOf(e),t,n))})[n]:(ObjectAttributeProperties.has(t)||ObjectAttributeProperties.set(t,{}),ObjectAttributeProperties.get(t))}function _superForValue(e){var t=_superForValue&&_superForValue.caller?_superForValue.caller:arguments.callee.caller,r=__super.call(this,t,e,!0,!1,!1),n=this;return r?function(){return r.apply(n,arguments)}:Function.noop}function _superForGet(e){var t=_superForGet&&_superForGet.caller?_superForGet.caller:arguments.callee.caller,r=__super.call(this,t,e,!1,!0,!1),n=this;return r?function(){return r.apply(n,arguments)}:Function.noop}function _superForSet(e){var t=_superForSet&&_superForSet.caller?_superForSet.caller:arguments.callee.caller,r=__super.call(this,t,e,!1,!1,!0),n=this;return r?function(){return r.apply(n,arguments)}:Function.noop}function _super(){var e=_super&&_super.caller?_super.caller:arguments.callee.caller,t=__super.call(this,e);return t?t.apply(this,arguments):void 0}function _superDependenciesFor(e){var t=_superDependenciesWeakMap.get(e);return t||_superDependenciesWeakMap.set(e,t=new Set),t}function _superMethodDependenciesFor(e){var t=_superMethodDependenciesMap.get(e);return t||_superMethodDependenciesMap.set(e,t=new Set),t}function __super(e,t,r,n,o){if(e||t){var a=__superWeakMap.get(e);if(!a){var i=typeof this===FUNCTION;a=findSuperMethodImplementation(e,i?this:this.constructor,i,t,r,n,o),a&&(__superWeakMap.set(e,a),_superMethodDependenciesFor(a).add(e))}return a}}function __clearSuperDepencies(e,t,r){var n,o,a,i=__superWeakMap,s=Object.getOwnPropertyDescriptor(e,t);if(s)if(typeof s.value===FUNCTION&&typeof r.value===FUNCTION)for(i["delete"](s.value),n=_superMethodDependenciesFor(s.value),o=n.values();a=o.next().value;)i["delete"](a);else{if(typeof s.get===FUNCTION&&typeof r.get===FUNCTION)for(i["delete"](s.get),n=_superMethodDependenciesFor(s.get),o=n.values();a=o.next().value;)i["delete"](a);if(typeof s.set===FUNCTION&&typeof r.set===FUNCTION)for(i["delete"](s.set),n=_superMethodDependenciesFor(s.set),o=n.values();a=o.next().value;)i["delete"](a)}if(n=_superDependenciesWeakMap.get(e))for(o=n.values();a=o.next().value;)__clearSuperDepencies(a,t,r)}function findSuperMethodImplementation(e,t,r,n,o,a,i){var s,p,u,c,l,g,f,d,b,h,y=global.Object,P=o,_=a,v=i;for(f=b=r?t:t.prototype;!h&&null!==b;){if(g){if(c=y.getOwnPropertyDescriptor(b,g)){if(c.hasOwnProperty("value")){l=c.value,h=!0;break}if(_&&c.hasOwnProperty("get")){l=c.get,h=!0;break}if(v&&c.hasOwnProperty("set")){l=c.set,h=!0;break}}}else for(s=n?(_propertyNames[0]=n)&&_propertyNames:y.getOwnPropertyNames(b),p=0;u=s[p];p++)if(c=y.getOwnPropertyDescriptor(b,u))if(null!=(l=c.value)){if(l===e||l.deprecatedFunction===e){g=u,P=!0;break}}else{if(null!=(l=c.get)&&(l===e||l.deprecatedFunction===e)){g=u,_=!0;break}if(null!=(l=c.set)&&(l===e||l.deprecatedFunction===e)){g=u,v=!0;break}}d=b,(b=y.getPrototypeOf(b))&&_superDependenciesFor(b).add(d)}return h&&typeof l===FUNCTION?l:Function.noop}require("collections/shim"),require("./shim/object"),require("./shim/array"),require("./extras/object"),require("./extras/date"),require("./extras/element"),require("./extras/function"),require("./extras/regexp"),require("./extras/string");var ATTRIBUTE_PROPERTIES="AttributeProperties",UNDERSCORE="_",PROTO="__proto__",VALUE="value",ENUMERABLE="enumerable",DISTINCT="distinct",SERIALIZABLE="serializable",FUNCTION="function",UNDERSCORE_UNICODE=95,ARRAY_PROTOTYPE=Array.prototype,OBJECT_PROTOTYPE=Object.prototype,accessorPropertyDescriptor={get:void 0,set:void 0,configurable:!1,enumerable:!1},valuePropertyDescriptor={value:void 0,configurable:!1,enumerable:!1,writable:!1},Map=require("collections/map"),WeakMap=require("collections/weak-map"),Set=require("collections/set"),__superWeakMap=new WeakMap;if(_superDependenciesWeakMap=new WeakMap,!Object.create.name){var fnNamePrefixRegex=/^[\S\s]*?function\s*/,fnNameSuffixRegex=/[\s\(\/][\S\s]+$/;Object.defineProperty(Function.prototype,"name",{get:_name})}var Montage=exports.Montage=function(){},PROTO_IS_SUPPORTED={}.__proto__===Object.prototype,PROTO_PROPERTIES_BLACKLIST={_montage_metadata:1,__state__:1,_hasUserDefinedConstructor:1};if(Montage.defineValueProperty=function e(t,r,n,o,a,i){e.template.value=n,e.template.configurable=o,e.template.enumerable=a,e.template.writable=i,this.defineProperty(t,r,e.template)},Montage.defineValueProperty.template=valuePropertyDescriptor,Montage.defineAccessorProperty=function t(e,r,n,o,a,i){t.template.get=n,t.template.set=o,t.template.configurable=a,t.template.enumerable=i,this.defineProperty(e,r,Montage_defineValueProperty.template)},Montage.defineAccessorProperty.template=accessorPropertyDescriptor,valuePropertyDescriptor.value=!1,Object.defineProperty(Montage,"_hasUserDefinedConstructor",valuePropertyDescriptor),valuePropertyDescriptor.value=function(e,t){var r,n,o,a,i,s,p,u=this,c="undefined"==typeof this.specialize;if(e=e||Object.empty,t=t||Object.empty,e.constructor&&e.constructor.value?(r=e.constructor.value,r._hasUserDefinedConstructor=!0):this._hasUserDefinedConstructor?r=function(){return this["super"]()||this}:(r=function(){return this},r.name=this.name+"Specialized"),PROTO_IS_SUPPORTED)r.__proto__=u;else{for(o=Object.getOwnPropertyNames(u),s=0,p=o.length;s<p;s++)a=o[s],PROTO_PROPERTIES_BLACKLIST.hasOwnProperty(a)||(i=Object.getOwnPropertyDescriptor(r,a),i&&!i.configurable||Montage.defineProperty(r,a,Object.getOwnPropertyDescriptor(u,a)));r.__constructorProto__=u,Montage.defineProperty(r,"isPrototypeOf",{value:function(e){for(var t;null!==e;){if(t=Object.getPrototypeOf(e),t===this)return!0;e=t}return!1},enumerable:!1})}if(n=Object.create(this.prototype),c){for(o=Object.getOwnPropertyNames(Montage),s=0,p=o.length;s<p;s++)a=o[s],i=Object.getOwnPropertyDescriptor(r,a),i&&!i.configurable||Montage.defineProperty(r,a,Object.getOwnPropertyDescriptor(Montage,a));for(o=Object.getOwnPropertyNames(Montage.prototype),s=0,p=o.length;s<p;s++)a=o[s],i=Object.getOwnPropertyDescriptor(r,a),i&&!i.configurable||Montage.defineProperty(n,a,Object.getOwnPropertyDescriptor(Montage.prototype,a))}return"objectDescriptor"in e&&Montage.defineProperty(r,"objectDescriptor",e.objectDescriptor),"blueprint"in e&&Montage.defineProperty(r,"blueprint",e.blueprint),"objectDescriptorModuleId"in e&&Montage.defineProperty(r,"objectDescriptorModuleId",e.objectDescriptorModuleId),"blueprintModuleId"in e&&Montage.defineProperty(r,"blueprintModuleId",e.blueprintModuleId),Montage.defineProperties(n,e,!0),Montage.defineProperties(r,t,!0),Montage.defineProperty(r,"__isConstructor__",{value:!0,enumerable:!1}),r.prototype=n,Montage.defineValueProperty(n,"constructor",r,!0,!1,!0),Montage.defineValueProperty(r,"constructor",r,!0,!1,!0),r},valuePropertyDescriptor.writable=!1,valuePropertyDescriptor.configurable=!0,valuePropertyDescriptor.enumerable=!1,Object.defineProperty(Montage,"specialize",valuePropertyDescriptor),!PROTO_IS_SUPPORTED){var originalGetPrototypeOf=Object.getPrototypeOf;Object.getPrototypeOf=function(e){return typeof e===FUNCTION&&e.__constructorProto__?e.__constructorProto__:originalGetPrototypeOf.apply(Object,arguments)}}valuePropertyDescriptor.writable=valuePropertyDescriptor.configurable=valuePropertyDescriptor.enumerable=!1,valuePropertyDescriptor.value=function(e,t,r,n){if("object"!=typeof e&&typeof e!==FUNCTION||null===e)throw new TypeError("Object must be an object, not '"+e+"'");var o=VALUE in r;if(DISTINCT in r&&!o)throw new TypeError("Cannot use distinct attribute on non-value property '"+t+"'");if(PROTO in r)r.__proto__=o?typeof r.value===FUNCTION?_defaultFunctionValueProperty:_defaultObjectValueProperty:_defaultAccessorProperty;else{var a;a=o?typeof r.value===FUNCTION?_defaultFunctionValueProperty:_defaultObjectValueProperty:_defaultAccessorProperty;for(var i in a)i in r||(r[i]=a[i])}return r.hasOwnProperty(ENUMERABLE)||t.charCodeAt(0)!==UNDERSCORE_UNICODE||(r.enumerable=!1),r.hasOwnProperty(SERIALIZABLE)||(r.enumerable?r.get&&!r.set?r.serializable=!1:r.writable===!1&&(r.serializable=!1):r.serializable=!1),SERIALIZABLE in r&&(getAttributeProperties(e,SERIALIZABLE)[t]=r.serializable),n||__clearSuperDepencies(e,t,r),Object.defineProperty(e,t,r)},Object.defineProperty(Montage,"defineProperty",valuePropertyDescriptor),Object.defineProperty(Montage,"defineProperties",{value:function(e,t,r){if("object"!=typeof t||null===t)throw new TypeError("Properties must be an object, not '"+t+"'");for(var n=Object.getOwnPropertyNames(t),o=0;property=n[o];o++)"_bindingDescriptors"!==property&&this.defineProperty(e,property,t[property],r);return e}});var _defaultAccessorProperty={enumerable:!0,configurable:!0,serializable:!0},_defaultObjectValueProperty={writable:!0,enumerable:!0,configurable:!0,serializable:"reference"},_defaultFunctionValueProperty={writable:!0,enumerable:!1,configurable:!0},_serializableAttributeProperties="_serializableAttributeProperties";Object.defineProperty(Montage.prototype,_serializableAttributeProperties,{enumerable:!1,configurable:!1,writable:!0,value:{}});var ObjectAttributeProperties=new Map;Montage.defineProperty(Montage,"didCreate",{value:Function.noop});var _superMethodDependenciesMap=new Map,_propertyNames=[];Montage.defineProperty(Montage,"super",{value:_super,enumerable:!1}),Montage.defineProperty(Montage.prototype,"super",{value:_super,enumerable:!1}),Montage.defineProperty(Montage,"superForValue",{value:_superForValue,enumerable:!1}),Montage.defineProperty(Montage.prototype,"superForValue",{value:_superForValue,enumerable:!1}),Montage.defineProperty(Montage,"superForGet",{value:_superForGet,enumerable:!1}),Montage.defineProperty(Montage.prototype,"superForGet",{value:_superForGet,enumerable:!1}),Montage.defineProperty(Montage,"superForSet",{value:_superForSet,enumerable:!1}),Montage.defineProperty(Montage.prototype,"superForSet",{value:_superForSet,enumerable:!1}),Montage.defineProperty(Montage,"getSerializablePropertyNames",{value:function(e){var t,r=getAttributeProperties(e,SERIALIZABLE);if(r){t=[];for(var n in r)r[n]&&t.push(n);return t}return Array.empty}}),Montage.defineProperty(Montage,"getPropertyAttribute",{value:function(e,t,r){var n=getAttributeProperties(e,r);if(n)return n[t]}}),Montage.defineProperty(Montage,"getPropertyAttributes",{value:function(e,t){var r,n=getAttributeProperties(e,t);if(n){r={};for(var o in n)r[o]=n[o];return r}}});var _instanceMetadataDescriptor={isInstance:{value:!0}},_functionInstanceMetadataDescriptor={objectName:{value:"Function"},isInstance:{value:!0}};Object.defineProperty(Montage.prototype,"_montage_metadata",{enumerable:!1,writable:!0,value:void 0}),Montage.defineProperty(Montage,"getInfoForObject",{value:function(e){var t,r;if(hasOwnProperty.call(e,"_montage_metadata")&&e._montage_metadata)return e._montage_metadata;if(t=e._montage_metadata||e.constructor&&e.constructor._montage_metadata||null,r=e.constructor===Function?_functionInstanceMetadataDescriptor:_instanceMetadataDescriptor,e===Object.prototype)return Object.create(t,r);try{return e.constructor===Object?Object.defineProperty(e,"_montage_metadata",{enumerable:!1,writable:!0,value:Object.create(t,r)})._montage_metadata:("_montage_metadata"in e.constructor.prototype||Object.defineProperty(e.constructor.prototype,"_montage_metadata",{enumerable:!1,writable:!0,value:void 0}),(e._montage_metadata=Object.create(t,r))||e._montage_metadata)}catch(n){return e._montage_metadata=Object.create(t,r)}}});var hasOwnProperty=Object.prototype.hasOwnProperty;Montage.defineProperty(Montage,"identifier",{value:null,serializable:!0}),Montage.defineProperty(Montage.prototype,"identifier",{value:null,serializable:!0}),Montage.defineProperty(Montage.prototype,"equals",{value:function(e){return!!e&&(this===e||this.uuid&&this.uuid===e.uuid)}}),Montage.defineProperty(Montage,"equals",{value:Montage.prototype.equals}),Montage.defineProperty(Montage.prototype,"callDelegateMethod",{value:function(e){var t,r=this.delegate;if(r&&("string"==typeof this.identifier&&typeof(t=r[this.identifier+e.toCapitalized()])===FUNCTION||typeof(t=r[e])===FUNCTION,t))return 2===arguments.length?t.call(r,arguments[1]):3===arguments.length?t.call(r,arguments[1],arguments[2]):4===arguments.length?t.call(r,arguments[1],arguments[2],arguments[3]):5===arguments.length?t.call(r,arguments[1],arguments[2],arguments[3],arguments[4]):(ARRAY_PROTOTYPE.shift.call(arguments),t.apply(r,arguments))}});var PropertyChanges=require("collections/listen/property-changes");Object.addEach(Montage,PropertyChanges.prototype),Object.addEach(Montage.prototype,PropertyChanges.prototype);var Bindings=exports.Bindings=require("frb"),bindingPropertyDescriptors={defineBinding:{value:function(e,t,r){return Bindings.defineBinding(this,e,t,r)}},defineBindings:{value:function(e,t){return Bindings.defineBindings(this,e,t)}},cancelBinding:{value:function(e){return Bindings.cancelBinding(this,e)}},cancelBindings:{value:function(){return Bindings.cancelBindings(this)}},getBinding:{value:function(e){return Bindings.getBinding(this,e)}},getBindings:{value:function(){return Bindings.getBindings(this)}}};Montage.defineProperties(Montage,bindingPropertyDescriptors),Montage.defineProperties(Montage.prototype,bindingPropertyDescriptors);var parse=require("frb/parse"),evaluate=require("frb/evaluate"),assign=require("frb/assign"),bind=require("frb/bind"),compileObserver=require("frb/compile-observer"),Scope=require("frb/scope"),Observers=require("frb/observers"),autoCancelPrevious=Observers.autoCancelPrevious,PathChangeDescriptor=function(){return this._willChangeListeners=null,this._changeListeners=null,this};Object.defineProperties(PathChangeDescriptor.prototype,{_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new Map)}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new Map)}}});var pathChangeDescriptors=new WeakMap,pathPropertyDescriptors={getPath:{value:function(e,t,r,n){return evaluate(e,this,t||this,r,n)}},setPath:{value:function(e,t,r,n,o){return assign(this,e,t,r||this,n,o)}},observePath:{value:function(e,t){var r=parse(e),n=compileObserver(r);return n(autoCancelPrevious(t),new Scope(this))}},addRangeAtPathChangeListener:{value:function(e,t,r,n,o,a){function i(e,n,o){if(t[r])t[r](e,n,o);else{if(!t.call)throw new Error("Can't dispatch range change to "+t);t.call(null,e,n,o)}}r=r||"handleRangeChange";var s=[];return this.addPathChangeListener(e,function(e){return e&&e.toArray&&e.addRangeChangeListener?(i(e.toArray(),s.toArray(),0),s=e,e.addRangeChangeListener(i)):(e=[],i(e,s,0),s=e,void 0)},void 0,void 0,n,o,a)}},getPathChangeDescriptors:{value:function(){return pathChangeDescriptors.has(this)||pathChangeDescriptors.set(this,new Map),pathChangeDescriptors.get(this)}},getPathChangeDescriptor:{value:function(e,t,r){var n=Montage.getPathChangeDescriptors.call(this);return n.has(e)||n.set(e,new PathChangeDescriptor),n=n.get(e),n=r?n.willChangeListeners:n.changeListeners,n.has(t)||n.set(t,{path:e,handler:t,beforeChange:r,cancel:Function.noop}),n.get(t)}},addPathChangeListener:{value:function(e,t,r,n,o,a,i){var s=this;t=t||Function.noop;var p=Montage.getPathChangeDescriptor.call(this,e,t,n);p.cancel();var u,c,l,g=parse(e);if(t===Function.noop)l=function(t){if(c)throw new Error("Path change handler needs a handler because it emits new values when the source changes: "+JSON.stringify(e));c=!0,u=t};else if(r)l=function(n){return t[r].call(t,n,e,s)};else if(t.handlePathChange)l=function(r){return t.handlePathChange.call(t,r,e,s)};else{if(typeof t!==FUNCTION)throw new Error("Can't recognize handler type: "+t+". Must be function or delegate implementing handlePathChange.");l=function(r){return t.call(s,r,e,s)}}var f=compileObserver(g),d=new Scope(this);d.beforeChange=n,d.parameters=o,d.document=a,d.components=i;var b=f(autoCancelPrevious(l),d);return p.cancel=b,c?u:b}},removePathChangeListener:{value:function(e,t,r){t=t||Function.noop;var n=Montage.getPathChangeDescriptors.call(this),o=r?"willChangeListeners":"changeListeners",a=n.get(e);if(!a)throw new Error("Can't find "+o+" for "+JSON.stringify(e));var i=a[o];if(!i.has(t))throw new Error("Can't find "+o+" for "+JSON.stringify(e));var s=i.get(t);s.cancel(),i["delete"](t),0===a.willChangeListeners.size&&0===a.changeListeners.size&&n["delete"](e),n.size<1&&pathChangeDescriptors["delete"](this)}},addBeforePathChangeListener:{value:function(e,t,r,n,o,a){return Montage.addPathChangeListener.call(this,e,t,r,!0,n,o,a)}},removeBeforePathChangeListener:{value:function(e,t,r){return Montage.removePathChangeListener.call(this,e,t,!0)}}};Montage.defineProperties(Montage,pathPropertyDescriptors),Montage.defineProperties(Montage.prototype,pathPropertyDescriptors),require("./serialization/bindings"),exports._objectDescriptorModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=Montage.getInfoForObject(t);var r=e.moduleId,n=r.lastIndexOf("/"),o=r.lastIndexOf(".");n=n===-1?0:n+1,o=o===-1?r.length:o,o=o<n?r.length:o,Montage.defineProperty(t,"_objectDescriptorModuleId",{enumerable:!1,value:r.slice(0,o)+".mjson"})}return t._objectDescriptorModuleId}},exports._blueprintModuleIdDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptorModuleId")||!t._objectDescriptorModuleId){e=Montage.getInfoForObject(t);var r=e.moduleId,n=r.lastIndexOf("/"),o=r.lastIndexOf(".");n=n===-1?0:n+1,o=o===-1?r.length:o,o=o<n?r.length:o,Montage.defineProperty(t,"_objectDescriptorModuleId",{enumerable:!1,value:r.slice(0,o)+".meta"})}return t._objectDescriptorModuleId}},exports._objectDescriptorDescriptor={serializable:!1,enumerable:!1,get:function(){var e=Montage.getInfoForObject(this),t=e&&!e.isInstance?this:this.constructor;if(!Object.getOwnPropertyDescriptor(t,"_objectDescriptor")||!t._objectDescriptor){var r=t.objectDescriptorModuleId||t.blueprintModuleId;if(!r)throw new TypeError("ObjectDescriptor moduleId undefined for the module '"+JSON.stringify(t)+"'");exports._objectDescriptorDescriptor.ObjectDescriptorModulePromise||(exports._objectDescriptorDescriptor.ObjectDescriptorModulePromise=require.async("core/meta/module-object-descriptor").get("ModuleObjectDescriptor")),Montage.defineProperty(t,"_objectDescriptor",{enumerable:!1,value:exports._objectDescriptorDescriptor.ObjectDescriptorModulePromise.then(function(e){var n=Montage.getInfoForObject(t);return e.getObjectDescriptorWithModuleId(r,n.require)["catch"](function(r){if(r.message.indexOf("Can't XHR")!==-1)return e.createDefaultObjectDescriptorForObject(t).then(function(e){return e});throw r})})})}return t._objectDescriptor},set:function(e){var t,r=Montage.getInfoForObject(this),n=r&&!r.isInstance?this:this.constructor;if(null===e)t=null;else{if(typeof e.then===FUNCTION)throw new TypeError("Object descriptor should not be a promise");e.objectDescriptorInstanceModule=n.objectDescriptorModule,t=require("./promise").Promise.resolve(e)}Montage.defineProperty(n,"_objectDescriptor",{enumerable:!1,value:t})}},exports._blueprintDescriptor=exports._objectDescriptorDescriptor;