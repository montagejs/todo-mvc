var Bindings=require("frb"),stringify=require("frb/stringify"),expand=require("frb/expand"),Scope=require("frb/scope"),Serializer=require("../serialization/serializer/montage-serializer").MontageSerializer,Deserializer=require("../serialization/deserializer/montage-deserializer").MontageDeserializer,BOUND_OBJECT="boundObject",ONE_WAY="<-",TWO_WAY="<->";Serializer.defineSerializationUnit("bindings",function(e,r){for(var i,n,t=Bindings.getBindings(r),o={},a=t.keys();n=a.next().value;){var s=t.get(n),c={};if((!("serializable"in s)||s.serializable)&&s.sourceSyntax){var d=s.sourcePath,b=s.sourceSyntax;if(s.source&&s.source!==r){var l=e.getObjectLabel(s.source),u=new Scope({type:"component",label:l});u.components=e,b=expand(b,u)}var u=new Scope;u.components=e,d=stringify(b,u),s.twoWay?c[TWO_WAY]=d:c[ONE_WAY]=d,s.converter?c.converter=s.converter:(c.convert=s.convert,c.revert=s.revert),s.trace&&(c.trace=!0),o[n]=c,i=!0}}return i?o:void 0}),Deserializer.defineDeserializationUnit("bindings",function(e,r,i){var n,t,o={components:e};for(n in i){if(t=i[n],"object"!=typeof t)throw new Error("Binding descriptor must be an object, not "+typeof t);BOUND_OBJECT in t&&(t.source=e.getObjectByLabel(t.boundObject),t.oneway?t[ONE_WAY]=t.boundPropertyPath:t[TWO_WAY]=t.boundPropertyPath,delete t.boundObject,delete t.boundObjectPropertyPath,delete t.oneway),Bindings.defineBinding(r,n,t,o)}});