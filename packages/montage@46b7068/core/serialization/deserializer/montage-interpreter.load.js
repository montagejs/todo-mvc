montageDefine("46b7068","core/serialization/deserializer/montage-interpreter",{dependencies:["../../core","./montage-reviver","../../promise"],factory:function(e,t,i){var n=e("../../core").Montage,r=e("./montage-reviver").MontageReviver,s=e("../../promise").Promise,u=n.specialize({_require:{value:null},_reviver:{value:null},init:{value:function(e,t){if("function"!=typeof e)throw new Error("Function 'require' missing.");return this._reviver=(new r).init(e,t),this._require=e,this}},instantiate:{value:function(e,t,i){var n;return n=(new o).init(e,this._reviver,t,i,this._require),n.getObjects()}},preloadModules:{value:function(e){var t,i,n,u,o=this._reviver,a=o.moduleLoader,l=[];for(var v in e)t=e[v],i=t.prototype||t.object,i&&(n=r.parseObjectLocationId(i),u=a.getModule(n.moduleId,v),s.is(u)&&l.push(u));if(l.length>0)return s.all(l)}}}),o=n.specialize({_ELEMENT_ID_ATTRIBUTE:{value:"data-montage-id"},_unitsToDeserialize:{value:null},_element:{value:null},_require:{value:null},_objects:{value:null},_userObjects:{value:null},_serialization:{value:null},_reviver:{value:null},constructor:{value:function(){this._unitsToDeserialize=[]}},init:{value:function(e,t,i,n,r){if(this._reviver=t,this._serialization=e,this._objects=Object.create(null),i){this._userObjects=Object.create(null);for(var s in i)this._userObjects[s]=i[s]}return this._element=n,this._require=r,this}},setObjectLabel:{value:function(e,t){this._objects[t]=e}},getObject:{value:function(e){var t,i=this._serialization,n=this._reviver,r=this._objects;return e in r?r[e]:e in i?(t=n.reviveRootObject(i[e],this,e),e in r||(r[e]=t),t):s.reject(new Error("Object with label '"+e+"' was not found."))}},getObjects:{value:function(){var e,t=this,i=this._serialization,n=[];for(var r in i)e=this.getObject(r),s.is(e)&&n.push(e);return 0===n.length?s.resolve(this._invokeDidReviveObjects()):s.all(n).then(function(){return t._invokeDidReviveObjects()})}},hasUserObject:{value:function(e){var t=this._userObjects;return!!t&&e in t}},getUserObject:{value:function(e){var t=this._userObjects;if(t)return t[e]}},_invokeDidReviveObjects:{value:function(){var e,t=this,i=this._reviver;return"function"==typeof i.didReviveObjects&&(e=i.didReviveObjects(this._objects,this),s.is(e))?e.then(function(){return t._objects}):this._objects}},hasObject:{value:function(e){return e in this._serialization}},getRequire:{value:function(){return this._require}},getElement:{value:function(){return this._element}},getElementById:{value:function(e){var t="*["+this._ELEMENT_ID_ATTRIBUTE+'="'+e+'"]';return this._element.querySelector(t)}},setUnitsToDeserialize:{value:function(e,t,i){this._unitsToDeserialize.push({object:e,objectDesc:t,unitNames:i})}},getUnitsToDeserialize:{value:function(){return this._unitsToDeserialize}}});t.MontageInterpreter=u,t.MontageContext=o}});