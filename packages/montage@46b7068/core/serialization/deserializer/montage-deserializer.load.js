montageDefine("46b7068","core/serialization/deserializer/montage-deserializer",{dependencies:["../../core","./montage-interpreter","./montage-reviver","../../deprecate"],factory:function(e,i,t){var n=e("../../core").Montage,r=e("./montage-interpreter").MontageInterpreter,a=e("./montage-reviver").MontageReviver,o=e("../../deprecate"),l=i.MontageDeserializer=n.specialize({_interpreter:{value:null},_serializationString:{value:null},_serialization:{value:null},serialization:{value:{get:function(){return this._serialization}}},init:{value:function(e,i,t){return this._serializationString=e,this._interpreter=(new r).init(i,t),this}},initWithObject:{value:function(e,i,t){return this._serializationString=JSON.stringify(e),this._interpreter=(new r).init(i,t),this}},initWithObjectAndRequire:{value:o.deprecateMethod(void 0,function(e,i,t){return this.initWithObject(e,i,t)},"initWithObjectAndRequire","initWithObject")},deserialize:{value:function(e,i){try{var t=JSON.parse(this._serializationString)}catch(n){return this._formatSerializationSyntaxError(this._serializationString)}return this._interpreter.instantiate(t,e,i)}},deserializeObject:{value:function(e){return this.deserialize(e).then(function(e){return e.root})}},preloadModules:{value:function(){var e=JSON.parse(this._serializationString);return this._interpreter.preloadModules(e)}},getExternalObjectLabels:{value:function(){var e=this._serialization,i=[];for(var t in e)0===Object.keys(e[t]).length&&i.push(t);return i}},_formatSerializationSyntaxError:{value:function(i){var t,n,r,a,o,l="   ",s=this._origin;return e.async("jslint/lib/jslint").then(function(e){if(e.JSHINT(i))t="Syntax error in the serialization but not able to find it!\n"+i;else{n=e.JSHINT.errors[0],r=i.split("\n"),a=(l+r.length).length,o=n.line-1;for(var u=0,c=r.length;u<c;u++)r[u]=new Array(a-(u+1+"").length+1).join(u===o?">":" ")+(u+1)+" "+r[u];t="Syntax error at line "+n.line+(s?" from "+s:"")+":\n"+n.evidence+"\n"+n.reason+"\n"+r.join("\n")}throw new Error(t)})}}});l.defineDeserializationUnit=function(e,i){a.defineUnitReviver(e,i)},i.deserialize=function(e,i){return(new l).init(e,i).deserializeObject()}}});