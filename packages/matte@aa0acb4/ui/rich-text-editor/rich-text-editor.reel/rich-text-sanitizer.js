var Montage=require("montage").Montage;exports.Sanitizer=Montage.specialize({willSetValue:{value:function(e,t){return this._scopeCSS(e,t)}},didGetValue:{value:function(e,t){return this._unscopeCSS(e,t)}},willInsertHtmlData:{value:function(e,t){return this._scopeCSS(this._removeScript(e),t)}},_scopeCSS:{enumerable:!0,value:function(e,t){var r=".editor-"+t+" ";return"string"==typeof e&&(e=e.replace(/(<style ?[^>]*>)([^<]*)(<\/style>)/gi,function(e,t,n,a){return n=n.replace(/\t|\n|\r/g,function(e){return"\t"==e?" ":""}),n=n.replace(/\*\.editor-[^ ] +/g,"body"),n=n.replace(/\.editor-[^ ]+ /g,""),n=n.replace(/([^{]+)({[^}]*})/gi,function(e,t,n){return t=t.replace(/ *([^,]+)/g,function(e,t){return"body"==t.toLowerCase()?"*"+r:r+t}),t+n}),t+n+a})),e}},_unscopeCSS:{enumerable:!0,value:function(e,t){return"string"==typeof e&&(e=e.replace(/(<style ?[^>]*>)([^<]*)(<\/style>)/gi,function(e,t,r,n){return r=r.replace(/\*\.editor-[^ ] +/g,"body"),r=r.replace(/\.editor-[^ ]+ /g,""),t+r+n})),e}},_removeScript:{enumerable:!0,value:function(e){var t=document.createElement("div"),r=function(e){var t,n,a,i=e.children,o=i.length,u=e.attributes,l=u.length;for(a=0;a<l;a++)n=u[a],(n.name.match(/^on[a-z]+/i)||n.value.match(/^javascript:/))&&(e.removeAttribute(n.name),a--,l--);for(a=0;a<o;a++)t=i[a],"SCRIPT"==t.tagName?(t.parentNode.removeChild(t),a--,o--):r(t)};return t.innerHTML=e,r(t),t.innerHTML}}});