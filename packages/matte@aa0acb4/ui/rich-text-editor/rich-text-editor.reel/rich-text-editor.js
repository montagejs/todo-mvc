var RichTextEditorBase=require("./rich-text-editor-base").RichTextEditorBase,Sanitizer=require("./rich-text-sanitizer").Sanitizer,Promise=require("montage/core/promise").Promise;exports.RichTextEditor=RichTextEditorBase.specialize({hasFocus:{enumerable:!0,get:function(){return this._hasFocus}},innerElement:{enumerable:!0,get:function(){return this._innerElement}},focus:{enumerable:!0,value:function(){this._needsFocus=!0,this.needsDraw=!0}},isActiveElement:{enumerable:!0,get:function(){return this._isActiveElement}},readOnly:{enumerable:!0,get:function(){return this._readOnly},set:function(e){this._readOnly!==e&&(this._readOnly=e,e&&this.hideOverlay(),this.needsDraw=!0)}},value:{get:function(){var e,t,i=this._innerElement,n="",r=null;return this._dirtyValue&&!this._value_locked&&(this._value_locked=!0,i&&(r=i.querySelector("Editor-overlay"),r&&(e=r.parentNode,t=r.nextSibling,e.removeChild(r)),n=i.innerHTML),"<br>"==n&&(n=""),void 0===this._sanitizer&&(this._sanitizer=new Sanitizer),this._sanitizer&&(n=this._sanitizer.didGetValue(n,this._uniqueId)),r&&e.insertBefore(r,t),this._value!=n&&(this.dispatchBeforeOwnPropertyChange("value",this._value),this._value=n,this.dispatchOwnPropertyChange("value",this._value)),this._dirtyValue=!1,this._value_locked=!1),this._value},set:function(e){(this._value!==e||this._dirtyValue)&&(this.hideOverlay(),void 0===this._sanitizer&&(this._sanitizer=new Sanitizer),this._sanitizer&&(e=this._sanitizer.willSetValue(e,this._uniqueId)),this._value=e,this._dirtyValue=!1,this._dirtyTextValue=!0,this._needsAssingValue=!0,this.needsDraw=!0),this._needsOriginalContent=!1}},textValue:{enumerable:!0,get:function(){var e,t,i=this._innerElement,n="",r=null;return this._dirtyTextValue&&!this._textValue_locked&&(this._textValue_locked=!0,i&&(r=i.querySelector("Editor-overlay"),r&&(e=r.parentNode,t=r.nextSibling,e.removeChild(r)),n=this._innerText(i),r&&e.insertBefore(r,t)),this._textValue!=n&&(this.dispatchBeforeOwnPropertyChange("textValue",this._textValue),this._textValue=n,this.dispatchOwnPropertyChange("textValue",this._textValue)),this._dirtyTextValue=!1,this._textValue_locked=!1),this._textValue},set:function(e){(this._textValue!==e||this._dirtyTextValue)&&(this.hideOverlay(),this._textValue=e,this._dirtyTextValue=!1,this._dirtyValue=!0,this._needsAssingValue=!0,this.needsDraw=!0),this._needsOriginalContent=!1}},delegate:{enumerable:!0,value:null},sanitizer:{enumerable:!1,get:function(){return this._sanitizer},set:function(e){this._sanitizer=e}},overlays:{enumerable:!1,get:function(){return this._overlays},set:function(e){this.hideOverlay(),e instanceof Array?(this._overlays=e,this._callOverlays("initWithEditor",this,!0)):this._overlays=null}},activeOverlay:{get:function(){return this._activeOverlay}},showOverlay:{value:function(e){var t=this._overlaySlot,i=t?t.element:null;i&&(this._activeOverlay=e,this._innerElement.appendChild(i.parentNode?i.parentNode.removeChild(i):i),t.attachToParentComponent(),t.content=e)}},hideOverlay:{value:function(e){var t=this._overlaySlot,i=t?t.element:null;i&&(i.parentNode&&i.parentNode.removeChild(i),this._activeOverlay=null,t.content=null)}},bold:{enumerable:!0,get:function(){return this._genericCommandGetter("bold","bold")},set:function(e){this._genericCommandSetter("bold","bold",e)}},underline:{enumerable:!0,get:function(){return this._genericCommandGetter("underline","underline")},set:function(e){this._genericCommandSetter("underline","underline",e)}},italic:{enumerable:!0,get:function(){return this._genericCommandGetter("italic","italic")},set:function(e){this._genericCommandSetter("italic","italic",e)}},strikeThrough:{enumerable:!1,get:function(){return this._genericCommandGetter("strikeThrough","strikethrough")},set:function(e){this._genericCommandSetter("strikeThrough","strikethrough",e)}},baselineShift:{enumerable:!0,get:function(){return this._baselineShift=this._baselineShiftGetState(),this._baselineShift},set:function(e){var t=this._baselineShiftGetState();t!=e&&("baseline"==e?"subscript"==t?this.doAction("subscript"):"superscript"==t&&this.doAction("superscript"):"subscript"==e?this.doAction("subscript"):"superscript"==e&&this.doAction("superscript"))}},indent:{enumerable:!0,value:function(){this.doAction("indent")}},outdent:{enumerable:!0,value:function(){this.doAction("outdent")}},listStyle:{enumerable:!0,get:function(){return this._listStyle=this._listStyleGetState(),this._listStyle},set:function(e){var t=this._listStyleGetState();t!=e&&("none"==e?this.doAction("ordered"==t?"insertorderedlist":"insertunorderedlist"):"ordered"==e?this.doAction("insertorderedlist"):"unordered"==e&&this.doAction("insertunorderedlist"))}},justify:{enumerable:!0,get:function(){return this._justify=this._justifyGetState(),this._justify},set:function(e){var t=this._justifyGetState();t!=e&&["left","center","right","full"].indexOf(e)!==-1&&this.doAction("justify"+e)}},fontName:{enumerable:!0,get:function(){return this._fontName=this._fontNameGetState(),this._fontName},set:function(e){this._genericCommandSetter("fontName","fontname",e)}},fontSize:{enumerable:!0,get:function(){return this._genericCommandGetter("fontSize","fontsize")},set:function(e){this._genericCommandSetter("fontSize","fontsize",e)}},backColor:{enumerable:!0,get:function(){return this._genericCommandGetter("backColor","backcolor")},set:function(e){this._genericCommandSetter("backColor","backcolor",null===e?"inherit":e)}},foreColor:{enumerable:!0,get:function(){return this._genericCommandGetter("foreColor","forecolor")},set:function(e){this._genericCommandSetter("foreColor","forecolor",null===e?"inherit":e)}},selectAll:{enumerable:!0,value:function(){this.doAction("selectall")}},selectElement:{enumerable:!0,value:function(e){var t,i;t=this._nodeOffset(e),t!==-1&&(i=document.createRange(),i.setStart(e.parentNode,t),i.setEnd(e.parentNode,t+1),this._selectedRange=i)}},undoManager:{enumerable:!0,get:function(){return this._undoManager},set:function(e){this._undoManager=e}},undo:{enumerable:!0,value:function(){this.undoManager?this.undoManager.undo():this._undo()}},redo:{enumerable:!0,value:function(){this.undoManager?this.undoManager.redo():this._redo()}},execCommand:{enumerable:!1,value:function(e,t,i,n){var r=document.activeElement,s=this._innerElement,a=!1;return!!s&&(s!=r&&s.focus(),void 0===i&&(i=!1),n=n||this._execCommandLabel[e]||"Typing",this._executingCommand=!0,document.execCommand(e,t,i)?(this._executingCommand=!1,["selectall"].indexOf(e)==-1?this.undoManager&&(this._stopTyping(),this.undoManager.register(n,Promise.resolve([this._undo,this,n,this._innerElement]))):this.markDirty(),this.handleSelectionchange(),a=!0):this._executingCommand=!1,s!=r&&r.focus(),a)}},markDirty:{enumerable:!1,value:function(){var e=this,t=function(){clearTimeout(e._forceUpdateValuesTimeout),delete e._forceUpdateValuesTimeout,clearTimeout(e._updateValuesTimeout),delete e._updateValuesTimeout,e._dirtyValue&&e.dispatchOwnPropertyChange("value",e.value),e._dirtyTextValue&&e.dispatchOwnPropertyChange("textValue",e.textValue),e._dispatchEditorEvent("editorChange")};this._needsAssingValue||(this._dirtyValue=!0,this._dirtyTextValue=!0),this._forceUpdateValuesTimeout||(this._forceUpdateValuesTimeout=setTimeout(t,1e3)),this._updateValuesTimeout&&clearTimeout(this._updateValuesTimeout),this._updateValuesTimeout=setTimeout(t,100)}}});