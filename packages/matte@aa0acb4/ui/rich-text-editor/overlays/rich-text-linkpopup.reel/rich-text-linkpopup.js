var Component=require("montage/ui/component").Component;exports.RichTextLinkPopup=Component.specialize({_isActive:{enumerable:!1,value:!1},_editor:{enumerable:!1,value:null},target:{enumerable:!1,value:null},_needsReset:{enumerable:!1,value:!1},initWithEditor:{value:function(e){this._editor=e}},editorMouseUp:{value:function(e){var t;if(this._editor.activeOverlay!=this&&"IMG"==e.target.nodeName)for(t=e.target;t&&t!=this._element;){if("A"==t.nodeName)return t!=this.target&&(this.target=t,this._needsReset=!0,this._isActive?this.needsDraw=!0:this._editor.showOverlay(this)),!0;t=t.parentElement}}},editorTouchEnd:{value:function(e){this.editorMouseUp(e)}},editorSelectionDidChange:{value:function(e){var t;if(e&&e.collapsed)for(t=e.commonAncestorContainer;t&&t!=this._element;){if("A"==t.nodeName)return t!=this.target&&(this.target=t,this._needsReset=!0,this._isActive?this.needsDraw=!0:this._editor.showOverlay(this)),!0;t=t.parentElement}return this._editor.activeOverlay==this&&this._editor.hideOverlay(),this.target=null,!1}},didBecomeActive:{value:function(){this._isActive=!0,window.addEventListener("resize",this,!1)}},didBecomeInactive:{value:function(){this._isActive=!1,window.removeEventListener("resize",this,!1),this.target=null,this._needsReset=!1}},enterDocument:{value:function(e){e&&(this._popupExtraWidth=this.element.offsetWidth)}},draw:{enumerable:!1,value:function(){var e=this.element,t=this.target,i=this._editor.innerElement;if(this._needsReset){var s,n,o,r,h,a,l,d,u=i.offsetHeight,f=i.offsetWidth,p=i.scrollTop,v=i.scrollLeft,c=t.offsetWidth,m=t.offsetHeight,_="",x=function(e){for(n=e.offsetTop,s=e.offsetLeft;(e=e.offsetParent)&&e!=i;)n+=e.offsetTop,s+=e.offsetLeft};x(t),o=s,r=n,_=r>60&&r-p+m+50>u?"bottom: "+(u-r+5)+"px;":"top: "+(r+m+5)+"px;",h=v,l=v+f,a=l-o,d=o+c-h,a>d?a<150?(_+=" left: "+(h+5)+"px;",_+=" max-width: "+(f-10-this._popupExtraWidth)+"px;"):(_+=" left: "+(h+o)+"px;",_+=" max-width: "+(a-5-this._popupExtraWidth)+"px;"):d<150?(_+=" right: "+(h+5)+"px;",_+=" max-width: "+(f-10-this._popupExtraWidth)+"px;"):(_+=" right: "+(l-(h+o+c+1))+"px;",_+=" max-width: "+(d-this._popupExtraWidth)+"px;"),e.setAttribute("style",_),this.link.href=t.href,this.link.textContent=t.href,this._needsReset=!1}}},handleResize:{enumerable:!1,value:function(){this._needsReset=!0,this.needsDraw=!0}}});