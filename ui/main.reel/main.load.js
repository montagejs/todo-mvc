montageDefine("42551f5","ui/main.reel/main",{dependencies:["montage/ui/component","montage/core/range-controller","core/todo","montage/core/serialization/serializer/montage-serializer","montage/core/serialization/deserializer/montage-deserializer"],factory:function(e,t,o){var n=e("montage/ui/component").Component,l=e("montage/core/range-controller").RangeController,i=e("core/todo").Todo,r=e("montage/core/serialization/serializer/montage-serializer").MontageSerializer,a=e("montage/core/serialization/deserializer/montage-deserializer").MontageDeserializer,d="todos-montage";t.Main=n.specialize({_newTodoForm:{value:null},_newTodoInput:{value:null},todoListController:{value:null},constructor:{value:function(){this.todoListController=new l,this.addPathChangeListener("todos.every{completed}",this,"handleTodosCompletedChanged"),this.defineBindings({todos:{"<-":"todoListController.content"},todosLeft:{"<-":"todos.filter{!completed}"},todosCompleted:{"<-":"todos.filter{completed}"}})}},_selectedFilter:{value:null},selectedFilter:{set:function(e){if(this._selectedFilter!==e&&(this._selectedFilter=e,this.todoListController)){var t=null;e&&(t="active"===e?"!completed":"completed"===e?"completed":null),this.todoListController.filterPath=t}},get:function(){return this._selectedFilter}},templateDidLoad:{value:function(){this.load()}},load:{value:function(){if(localStorage){var t=localStorage.getItem(d);if(t){var o=new a,n=this;o.init(t,e).deserializeObject().then(function(e){n.todoListController.content=e},function(e){console.error("Could not load saved tasks."),console.debug("Could not deserialize",t),console.log(e.stack)})}}}},save:{value:function(){if(localStorage){var t=this.todoListController.content,o=(new r).initWithRequire(e);localStorage.setItem(d,o.serializeObject(t))}}},enterDocument:{value:function(e){if(e){if(this._newTodoForm.identifier="newTodoForm",this._newTodoForm.addEventListener("submit",this,!1),window.location&&window.location.hash){var t=window.location.hash.substring(2);"active"!==t&&"completed"!==t||(this._filterController.value=t)}this.addEventListener("destroyTodo",this,!0),window.addEventListener("beforeunload",this,!0)}}},captureDestroyTodo:{value:function(e){this.destroyTodo(e.detail.todo)}},createTodo:{value:function(e){var t=(new i).initWithTitle(e);return this.todoListController.add(t),t}},destroyTodo:{value:function(e){return this.todoListController["delete"](e),e}},_allCompleted:{value:null},allCompleted:{get:function(){return this._allCompleted},set:function(e){this._allCompleted=e,this.todoListController&&this.todoListController.content&&this.todoListController.content.forEach(function(t){t.completed=e})}},todos:{value:null},todosLeft:{value:null},todosCompleted:{value:null},handleNewTodoFormSubmit:{value:function(e){e.preventDefault();var t=this._newTodoInput.value.trim();""!==t&&(this.createTodo(t),this._newTodoInput.value=null)}},handleTodosCompletedChanged:{value:function(e){this._allCompleted=e,this.dispatchOwnPropertyChange("allCompleted",e)}},handleClearCompletedButtonAction:{value:function(){var e=this.todoListController.content.filter(function(e){return e.completed});e.length>0&&this.todoListController.deleteEach(e)}},captureBeforeunload:{value:function(){this.save()}}})}});